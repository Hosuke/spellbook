version: 2

sources:
  - name: dex
    database: spellbook
    schema: dex
    tables:
      - name: mento_v2_celo_base_trades
      - name: mento_v1_celo_base_trades
      - name: uniswap_v3_base_base_trades
      - name: uniswap_v3_arbitrum_base_trades
      - name: uniswap_v3_optimism_base_trades
      - name: uniswap_v3_polygon_base_trades
      - name: uniswap_v3_ethereum_base_trades
      - name: uniswap_v2_ethereum_base_trades
      - name: sushiswap_v1_ethereum_base_trades
      - name: sushiswap_v2_ethereum_base_trades

models:
  - name: dex_ci_trades_test
    meta:
      blockchain: arbitrum, avalanche_c, base, bnb, celo, ethereum, fantom, gnosis, kaia, optimism, polygon, scroll, zksync, linea, blast, sei, ronin
      sector: dex
      contributors: hosuke
    config:
      tags: ['dex', 'trades', 'ci_test']
    description: "CI test view that processes modified base_trades models to verify their integration with the dex.trades pipeline"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - blockchain
            - project
            - version
            - tx_hash
            - evt_index
    columns:
      - name: blockchain
        description: "Blockchain on which this trade occurred"
      - name: project
        description: "Name of the dex on which the trade occurred"
        data_tests:
          - relationships:
              to: ref('dex_info')
              field: project
      - name: version
        description: "Version of the DEX protocol/contract"
      - name: block_month
        description: "UTC event block month"
      - name: block_date
        description: "UTC event block date"
      - name: block_time
        description: "UTC event block time"
      - name: block_number
        description: "Block number of the block in which the trade occurred"
      - name: token_bought_symbol
        description: "Symbol of the token bought in the trade"
      - name: token_sold_symbol
        description: "Symbol of the token sold in the trade"
      - name: token_pair
        description: "symbol pair for the tokens involved in the trade. e.g. 'ETH/USDC'. Always alphabetical order, not trade order."
      - name: token_bought_amount
        description: "Amount of the token bought in the display unit"
      - name: token_sold_amount
        description: "Amount of the token sold in the display unit"
      - name: token_bought_amount_raw
        description: "Amount of the token bought in the base unit"
      - name: token_sold_amount_raw
        description: "Amount of the token sold in the base unit"
      - name: amount_usd
        description: "USD value of the trade at time of execution. Can be null if we don't have enough data to calculate the value."
        data_tests:
          - dbt_utils.accepted_range:
              max_value: 1000000000 # $1b is an arbitrary number, intended to flag outlier amounts early
      - name: token_bought_address
        description: "Contract address of the token bought"
      - name: token_sold_address
        description: "Contract address of the token sold"
      - name: taker
        description: "Address of account which purchased tokens. Can be contracts or EOA addresses. "
      - name: maker
        description: "Address of account which sold tokens. Can be contracts or EOA addresses."
      - name: project_contract_address
        description: "Smart contract address which emitted the event associated with this trade."
      - name: tx_hash
        description: "The hash of the transaction that this trade was included in"
      - name: evt_index
        description: "Index of the event in the transaction"
