version: 2

models:
  - name: gas_abstract_fees
    meta:
      blockchain: abstract
      sector: gas
      contributors: hosuke
    config:
      tags: ['abstract', 'gas', 'fees']
    description: >
        Gas Fees on Abstract. Note that Abstract uses a unique gas fee mechanism that includes both L2 execution gas (similar to other L2s) 
        and batch overhead gas (which covers costs for posting data to Layer 1). The current implementation approximates the total fee
        using available on-chain data but may not capture the full overhead component accurately.
        
        Abstract's fee formula is:
        txn_fee = L2_execution + overhead_gas
        where:
        - L2_execution = L2_gas_units * L2_gas_price (similar to standard EVM gas)
        - overhead_gas ~= L1_base_fee * txn_size (bytes) + K (where K is a constant for proving costs)
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_month
            - block_number
            - tx_hash
      - check_seed:
          seed_file: ref('evm_gas_fees')
          filter:
            blockchain: abstract
          match_columns:
            - blockchain
            - tx_hash
          check_columns:
            - tx_fee_raw
      - dbt_utils.expression_is_true:
          expression: "tx_fee_raw >= 0"
          config:
            where: "block_time > now() - interval '7' day" 