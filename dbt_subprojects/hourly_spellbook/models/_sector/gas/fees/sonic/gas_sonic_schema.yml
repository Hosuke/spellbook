version: 2

models:
  - name: gas_sonic_fees
    meta:
      blockchain: sonic
      sector: gas
      contributors: hosuke
    config:
      tags: ['sonic', 'gas', 'fees']
    description: >
      Gas Fees on Sonic
      
      Sonic is an EVM-compatible Layer-1 blockchain designed for high performance and optimized for trading applications.
      
      The gas fee mechanism on Sonic includes several unique components:
      
      1. Native Token (S): Used for gas payments, staking, and network validation. All transaction fees are paid in S token.
      
      2. Specialized Fee Distribution System:
         - For non-FeeM transactions: 50% is burned, 45% goes to validators, 5% goes to Ecosystem Vault
         - For FeeM (Fee Monetization) transactions: Up to 90% goes to app developers, 10% goes to validators
      
      3. Fee Monetization (FeeM): An innovative program that allows approved applications to receive most of 
         the gas fees generated by their users, creating a sustainable revenue model for developers.
      
      4. Double-Spend Prevention: The system accurately tracks gas consumption within the virtual machine and
         splits rewards based on the gas each sub-operation consumes, ensuring fair distribution.
      
      5. Transaction Types: Supports standard EVM transactions including EIP-1559 style transactions with
         base fee and priority fee components.
      
      The gas fee mechanism on Sonic is designed to create a sustainable L1 model that benefits validators,
      developers, and users through its innovative fee distribution and monetization system.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_month
            - block_number
            - tx_hash
      - check_seed:
          seed_file: ref('evm_gas_fees')
          filter:
            blockchain: sonic
          match_columns:
            - blockchain
            - tx_hash
          check_columns:
            - tx_fee_raw
      - dbt_utils.expression_is_true:
          expression: "tx_fee_raw = reduce(map_values(tx_fee_breakdown_raw),uint256 '0',(s, x) -> s + x,s -> s)"
          config:
            where: "block_time > now() - interval '7' day"