version: 2

models:
  - name: gas_ink_fees
    meta:
      blockchain: ink
      sector: gas
      contributors: hosuke
    config:
      tags: ['ink', 'gas', 'fees']
    description: >
        Gas Fees on Ink Network (OP Stack)
        
        Ink is an Ethereum Layer 2 blockchain built on the Optimism OP Stack (Superchain) designed to be the house of DeFi for the Superchain.
        
        As a Superchain L2, the fee for each transaction on Ink has two components:
        1. An execution fee for the chain itself (L2 execution fee)
        2. A security fee that helps secure the L2 by publishing L2 transactions to Ethereum (L1 data fee)
        
        The security fee is generally higher than the execution fee because L1 transactions tend to be more expensive
        due to Ethereum's congestion and gas price fluctuations.
        
        Being an OP Stack chain, Ink inherits the gas fee mechanism from Optimism, which means:
        - EIP-1559 style fee market for L2 execution fees
        - L1 security fees that vary based on Ethereum gas prices
        - Low overall fees compared to Ethereum mainnet
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_month
            - block_number
            - tx_hash
      - check_seed:
          seed_file: ref('evm_gas_fees')
          filter:
            blockchain: ink
          match_columns:
            - blockchain
            - tx_hash
          check_columns:
            - tx_fee_raw
      - dbt_utils.expression_is_true:
          expression: "tx_fee_raw = reduce(map_values(tx_fee_breakdown_raw),uint256 '0',(s, x) -> s + x,s -> s)"
          config:
            where: "block_time > now() - interval '7' day"